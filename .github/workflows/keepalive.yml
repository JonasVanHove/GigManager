name: Keep Supabase Active

# Supabase free-tier pauses the database after 7 days of inactivity.
# This workflow pings the REST API every 4 days to prevent that.

on:
  schedule:
    - cron: "0 8 */4 * *" # Every 4 days at 08:00 UTC
  workflow_dispatch: # Manual trigger

jobs:
  ping:
    name: Ping Supabase
    runs-on: ubuntu-latest
    steps:
      - name: Wake database via REST API
        run: |
          echo "Pinging Supabase to keep database active…"
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" \
            "${{ secrets.SUPABASE_URL }}/rest/v1/" \
            -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}")
          echo "HTTP status: $HTTP_CODE"
          if [ "$HTTP_CODE" -ge 200 ] && [ "$HTTP_CODE" -lt 400 ]; then
            echo "✅ Database is alive."
          else
            echo "⚠️  Ping returned $HTTP_CODE — database may be paused."
            exit 1
          fi
